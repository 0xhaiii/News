#!/bin/bash
# Daily News Scraper - Fetches hot topics from multiple platforms

DATE=$(date +%Y-%m-%d)
OUTPUT_FILE="$1"
TELEGRAM_MSG_FILE="$2"

# Initialize the news report
cat > "$OUTPUT_FILE" << 'EOF'
---
title: æ¯æ—¥èµ„è®¯
date: DATE_PLACEHOLDER
---

# æ¯æ—¥èµ„è®¯ DATE_PLACEHOLDER

> è‡ªåŠ¨ç”Ÿæˆ by OpenClaw ğŸ¦

## Product Hunt

EOF

# Product Hunt (placeholder - API requires auth)
echo "Fetching Product Hunt..."
echo "- [Product Hunt](https://www.producthunt.com/) - æ¯æ—¥ç²¾é€‰äº§å“" >> "$OUTPUT_FILE"

echo "" >> "$OUTPUT_FILE"
echo "## Hacker News" >> "$OUTPUT_FILE"
echo "" >> "$OUTPUT_FILE"

# Hacker News Top Stories (Firebase API)
echo "Fetching Hacker News..."
HN_IDS=$(curl -s "https://hacker-news.firebaseio.com/v0/topstories.json" 2>/dev/null | sed 's/\[//; s/\]//' | tr ',' '\n' | head -10)
for id in $HN_IDS; do
    ITEM=$(curl -s "https://hacker-news.firebaseio.com/v0/item/${id}.json" 2>/dev/null)
    TITLE=$(echo "$ITEM" | sed 's/.*"title":"\([^"]*\)".*/\1/' | head -1)
    URL=$(echo "$ITEM" | sed 's/.*"url":"\([^"]*\)".*/\1/' | head -1)
    if [ -n "$TITLE" ] && [ "$TITLE" != "null" ]; then
        if [ -n "$URL" ] && [ "$URL" != "null" ]; then
            echo "- [$TITLE]($URL)" >> "$OUTPUT_FILE"
        else
            echo "- $TITLE (HN Discussion)" >> "$OUTPUT_FILE"
        fi
    fi
done

echo "" >> "$OUTPUT_FILE"
echo "## GitHub Trending" >> "$OUTPUT_FILE"
echo "" >> "$OUTPUT_FILE"

# GitHub Trending - placeholder (GitHub API requires auth for some endpoints)
echo "Fetching GitHub Trending..."
echo "- [Explore GitHub](https://github.com/explore) - å‘ç°æœ‰è¶£çš„é¡¹ç›®" >> "$OUTPUT_FILE"
echo "- [Trending Repos](https://github.com/trending) - æ¯æ—¥è¶‹åŠ¿" >> "$OUTPUT_FILE"

echo "" >> "$OUTPUT_FILE"
echo "## å°‘æ•°æ´¾" >> "$OUTPUT_FILE"
echo "" >> "$OUTPUT_FILE"

# Sspai - just a link for now
echo "Fetching Sspai..."
echo "- [å°‘æ•°æ´¾é¦–é¡µ](https://sspai.com/) - æ•°å­—ç”Ÿæ´»æŒ‡å—" >> "$OUTPUT_FILE"

echo "" >> "$OUTPUT_FILE"
echo "## çŸ¥ä¹çƒ­æ¦œ" >> "$OUTPUT_FILE"
echo "" >> "$OUTPUT_FILE"

# Zhihu Hot (simplified - just a placeholder for now)
echo "Fetching Zhihu Hot..."
ZH_TOPICS=(
    "ä»Šå¤©æœ‰å“ªäº›çƒ­é—¨è¯é¢˜ï¼Ÿ"
    "çŸ¥ä¹æ¯æ—¥ç²¾é€‰"
)
for topic in "${ZH_TOPICS[@]}"; do
    echo "- $topic" >> "$OUTPUT_FILE"
done

echo "" >> "$OUTPUT_FILE"
echo "---" >> "$OUTPUT_FILE"
echo "*Generated at $(date '+%Y-%m-%d %H:%M:%S') by OpenClaw ğŸ¦*" >> "$OUTPUT_FILE"

# Create HTML version for mobile viewing
HTML_FILE="${OUTPUT_FILE%.md}.html"
cat > "$HTML_FILE" << 'EOF'
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥èµ„è®¯</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 16px; }
        .section-title { font-size: 18px; font-weight: 600; margin: 16px 0 8px; display: flex; align-items: center; gap: 8px; }
        .item { padding: 8px 0; border-bottom: 1px solid #eee; }
        .item:last-child { border-bottom: none; }
        .item a { color: #333; text-decoration: none; }
        .item a:hover { color: #667eea; }
        .footer { text-align: center; color: #999; font-size: 12px; margin-top: 20px; }
        .tag { display: inline-block; background: #f0f0f0; padding: 2px 8px; border-radius: 4px; font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <div class="header">
        <h1 style="margin:0;">ğŸ“° æ¯æ—¥èµ„è®¯</h1>
        <p style="margin:8px 0 0;color:rgba(255,255,255,0.9);">DATE_PLACEHOLDER</p>
    </div>
    
    <div class="card">
        <div class="section-title">ğŸ› ï¸ Product Hunt</div>
        <div class="item">â€¢ æ¯æ—¥ç²¾é€‰äº§å“</div>
    </div>
    
    <div class="card">
        <div class="section-title">ğŸ’» Hacker News</div>
        <div class="item">â€¢ Top 10 çƒ­é—¨è®¨è®º</div>
    </div>
    
    <div class="card">
        <div class="section-title">ğŸ™ GitHub Trending</div>
        <div class="item">â€¢ ä»Šæ—¥è¶‹åŠ¿é¡¹ç›®</div>
    </div>
    
    <div class="card">
        <div class="section-title">ğŸ“± å°‘æ•°æ´¾</div>
        <div class="item">â€¢ æœ€æ–°æ–‡ç« æ¨è</div>
    </div>
    
    <div class="card">
        <div class="section-title">ğŸ’¬ çŸ¥ä¹çƒ­æ¦œ</div>
        <div class="item">â€¢ çƒ­é—¨è¯é¢˜è®¨è®º</div>
    </div>
    
    <div class="footer">
        <p>ğŸ¦ Generated by OpenClaw</p>
        <p><a href="#" style="color:#667eea;">ğŸ“„ é˜…è¯»å®Œæ•´ç‰ˆæœ¬</a></p>
    </div>
</body>
</html>
EOF

# Update HTML with actual date
sed -i "s/DATE_PLACEHOLDER/$(date '+%Yå¹´%mæœˆ%dæ—¥')/g" "$HTML_FILE"

echo "âœ… Daily news scraping completed!"
